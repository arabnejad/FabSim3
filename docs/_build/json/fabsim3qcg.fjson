{
    "body": "<div class=\"section\" id=\"fabsim3-with-qcg-middleware\">\n<span id=\"fabsim3qcg\"></span><h1>FabSim3 with QCG middleware<a class=\"headerlink\" href=\"#fabsim3-with-qcg-middleware\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>This document explains how users should set and use remote machine functionality.</p>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">In this tutorial, all parameters are set based on our tested target machine  (the Eagle cluster at PSNC), which uses <a class=\"reference external\" href=\"http://apps.man.poznan.pl/trac/qcg\">QCG Middleware</a> for resource management. For the local testing, you need to change them based your remote machine configuration and usage software.</p>\n</div>\n<div class=\"section\" id=\"machine-configuration\">\n<h2>Machine configuration<a class=\"headerlink\" href=\"#machine-configuration\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>To execute jobs through remote resource schedulers, some <strong>essential</strong> machine-specific configurations are required to be set and stored. These parameters will be applied to all applications run on that remote machine.</p>\n<p>First, you need to add your <strong>username</strong> for remote machine in <code class=\"docutils literal notranslate\"><span class=\"pre\">/deploy/machines_user.yml</span></code> file as:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">qcg</span><span class=\"p\">:</span> <span class=\"c1\"># machine name</span>\n     <span class=\"n\">username</span><span class=\"p\">:</span> <span class=\"s2\">&quot;plg...&quot;</span>\n</pre></div>\n</div>\n<p>Then, set up configuration for remote machine in <code class=\"docutils literal notranslate\"><span class=\"pre\">/deploy/machines.yml</span></code> file. Here is a simple example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">qcg</span><span class=\"p\">:</span> <span class=\"c1\"># machine name</span>\n     <span class=\"n\">remote</span><span class=\"p\">:</span> <span class=\"s1\">&#39;eagle.man.poznan.pl&#39;</span>\n     <span class=\"n\">home_path_template</span><span class=\"p\">:</span> <span class=\"s1\">&#39;/home/plgrid/$username&#39;</span>\n     <span class=\"n\">manual_ssh</span><span class=\"p\">:</span> <span class=\"n\">true</span>\n     <span class=\"n\">dispatch_jobs_on_localhost</span><span class=\"p\">:</span> <span class=\"n\">true</span>\n     <span class=\"n\">job_dispatch</span> <span class=\"p\">:</span> <span class=\"s1\">&#39;qcg-sub&#39;</span>\n     <span class=\"n\">batch_header</span><span class=\"p\">:</span> <span class=\"n\">qcg</span><span class=\"o\">-</span><span class=\"n\">eagle</span>\n     <span class=\"n\">stat</span><span class=\"p\">:</span> <span class=\"s1\">&#39;qcg-list -Q -s all -F &quot;%-22I %-16S %-8H&quot; | awk &quot;{if(NR&gt;2)print}&quot;&#39;</span>\n     <span class=\"n\">job_dispatch</span><span class=\"p\">:</span> <span class=\"s1\">&#39;qcg-sub&#39;</span>\n     <span class=\"n\">cancel_job_command</span><span class=\"p\">:</span> <span class=\"s1\">&#39;qcg-cancel $jobID&#39;</span>\n     <span class=\"n\">job_info_command</span> <span class=\"p\">:</span> <span class=\"s1\">&#39;qcg-info -Q $jobID&#39;</span>\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">qcg</span></code>: the name of target remote machine machine , it will use by FabSim3 as <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">qcg</span> <span class=\"pre\">&lt;command&gt;</span></code>. Internally, FabSim3 uses <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;$user_name&gt;&#64;&lt;$remote&gt;</span></code> to connect to the remote machine.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">remote</span></code>: the remote machine address. FabSim3 uses <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;$user_name&gt;&#64;&lt;$remote&gt;</span></code> template internally all connection. The <code class=\"docutils literal notranslate\"><span class=\"pre\">user_name</span></code> parameter is taken from <code class=\"docutils literal notranslate\"><span class=\"pre\">/deploy/machines.yml</span></code> file.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">home_path_template</span></code>: used to the storage space to checkout and build on the remote machine.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">manual_ssh</span></code>: when enabled, FabSim3 will connect directly using an ssh client instead of using the paramiko api.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">dispatch_jobs_on_localhost</span></code>: if it is set to <strong>true</strong>, job dispatch is done locally. Otherwise, FabSim3 executes commands directly inside the remote machine by <strong>ssh</strong> connection. To dispatch job locally, the command-line interface for job management should be installed in your local machine.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">batch_header</span></code>: it can be used to add some predefined templates to the submitted job script. The template file should be store at <code class=\"docutils literal notranslate\"><span class=\"pre\">/deploy/templates</span></code>.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">stat</span></code>: filled by the command-line that displays report on the submitted jobs. In this example, according to our grid broker, <code class=\"docutils literal notranslate\"><span class=\"pre\">qcg-list</span></code> command displays table with information about tasks.</li>\n</ul>\n<p>It should be set in the way that only return jobID, job status, and host in the output (without column header). For example, the template output should be similar to:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"o\">=======</span>   <span class=\"o\">=========</span>   <span class=\"o\">===========</span>\n<span class=\"n\">jobID1</span>    <span class=\"n\">FINISHED</span>    <span class=\"n\">eagle</span>\n<span class=\"n\">jobID2</span>    <span class=\"n\">FAILED</span>      <span class=\"n\">tryton</span>\n<span class=\"n\">jobID3</span>    <span class=\"n\">CANCELED</span>    <span class=\"n\">prometheus</span>\n<span class=\"o\">=======</span>   <span class=\"o\">=========</span>   <span class=\"o\">===========</span>\n</pre></div>\n</div>\n<ul class=\"simple\">\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">job_dispatch</span></code>: the command to submit the task to be processed by remote machine.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">cancel_job_command</span></code>: the command to cancel the submitted task based on input <strong>$jobID</strong>. the <strong>$jobID</strong> variable will be set during the execution, keep the format as <strong>$jobID</strong> in the parameters list.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">job_info_command</span></code>: the command to display a comprehensive information of a specific <strong>jobID</strong>. Please set this parameters based on the workload manager of target remote machine, i.e : <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;command&gt;</span> <span class=\"pre\">&lt;parameters&gt;</span> <span class=\"pre\">$jobID</span></code>. The <strong>$jobID</strong> variable will be set during the execution, keep the format as <strong>$jobID</strong> in the parameters list.</li>\n</ul>\n</div>\n<div class=\"section\" id=\"job-executing-monitoring-and-fetching-results-on-a-remote-host\">\n<h2>Job Executing, Monitoring, and Fetching results on a remote host<a class=\"headerlink\" href=\"#job-executing-monitoring-and-fetching-results-on-a-remote-host\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"section\" id=\"job-submisson\">\n<h3>Job Submisson<a class=\"headerlink\" href=\"#job-submisson\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<ul>\n<li><p class=\"first\">To submit a job on the remote mahcine, type:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fab</span> <span class=\"o\">&lt;</span><span class=\"n\">machine</span> <span class=\"n\">name</span><span class=\"o\">&gt;</span> <span class=\"n\">install_plugin</span><span class=\"p\">:</span><span class=\"o\">&lt;</span><span class=\"n\">plug_name</span><span class=\"o\">&gt;</span>\n</pre></div>\n</div>\n</li>\n</ul>\n<p>This does the following:\n* Copy your job input to the remote machine location specified in the variable.\n* By each job submssion, the associated jobID will be stored in the jobs database in <code class=\"docutils literal notranslate\"><span class=\"pre\">/deploy/.jobsDB</span></code>  at your local machine.</p>\n</div>\n<div class=\"section\" id=\"job-monitoring\">\n<h3>Job Monitoring<a class=\"headerlink\" href=\"#job-monitoring\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<ul>\n<li><p class=\"first\"><code class=\"docutils literal notranslate\"><span class=\"pre\">job_stat</span></code>: returns a report for all submitted jobs or a one in Particular. By default <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">&lt;machine&gt;</span> <span class=\"pre\">job_stat</span></code> reports the status of jobs saved in the local jobs database.</p>\n<blockquote>\n<div><p>$ fab &lt;machine&gt; job_stat</p>\n<blockquote>\n<div><table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"45%\" />\n<col width=\"33%\" />\n<col width=\"22%\" />\n</colgroup>\n<tbody valign=\"top\">\n<tr class=\"row-odd\"><td>JobID</td>\n<td>Job Status</td>\n<td>Host</td>\n</tr>\n<tr class=\"row-even\"><td>J1550579738985__5903</td>\n<td>FINISHED</td>\n<td>eagle</td>\n</tr>\n<tr class=\"row-odd\"><td>J1550579822765__3295</td>\n<td>FAILED</td>\n<td>eagle</td>\n</tr>\n<tr class=\"row-even\"><td>J1551348984148__7461</td>\n<td>CANCELED</td>\n<td>eagle</td>\n</tr>\n</tbody>\n</table>\n</div></blockquote>\n</div></blockquote>\n</li>\n</ul>\n<p>To return task information for all submitted jobs, you can use <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">&lt;machine&gt;</span> <span class=\"pre\">job_stat:period=all</span></code>. Also, to return the status for a specific task, type:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fab</span> <span class=\"o\">&lt;</span><span class=\"n\">machine</span><span class=\"o\">&gt;</span> <span class=\"n\">job_stat</span><span class=\"p\">:</span><span class=\"n\">jobID</span><span class=\"o\">=...</span>\n</pre></div>\n</div>\n<ul>\n<li><p class=\"first\"><code class=\"docutils literal notranslate\"><span class=\"pre\">job_stat_update</span></code>: updates the job status in the local database file</p>\n<blockquote>\n<div><p>$ fab &lt;machine&gt; job_stat_update</p>\n<blockquote>\n<div><table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"41%\" />\n<col width=\"30%\" />\n<col width=\"30%\" />\n</colgroup>\n<tbody valign=\"top\">\n<tr class=\"row-odd\"><td>JobID</td>\n<td>current Status</td>\n<td>New Status</td>\n</tr>\n<tr class=\"row-even\"><td>J1550579738985__5925</td>\n<td>FAILED</td>\n<td>\u2013</td>\n</tr>\n<tr class=\"row-odd\"><td>J1550579822765__9151</td>\n<td>PREPROCESSING</td>\n<td>PENDING</td>\n</tr>\n<tr class=\"row-even\"><td>J1551348984148__8504</td>\n<td>PENDING</td>\n<td>FINISHED</td>\n</tr>\n</tbody>\n</table>\n</div></blockquote>\n</div></blockquote>\n</li>\n</ul>\n<blockquote>\n<div><ul class=\"simple\">\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">job_info</span></code>: returns an extened reports on for a specefic job, <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">&lt;machine&gt;</span> <span class=\"pre\">job_info:&lt;jobID&gt;</span></code></li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">cancel_job</span></code>: will cancel a remote job, <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">&lt;machine&gt;</span> <span class=\"pre\">cancel_job:&lt;jobID&gt;</span></code></li>\n</ul>\n</div></blockquote>\n</div>\n<div class=\"section\" id=\"fetaching-results\">\n<h3>Fetaching results<a class=\"headerlink\" href=\"#fetaching-results\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<ul>\n<li><p class=\"first\">You can fetch the remote data using</p>\n<blockquote>\n<div><p>fab &lt;machine&gt; fetch_results</p>\n</div></blockquote>\n</li>\n</ul>\n</div>\n</div>\n</div>\n",
    "title": "FabSim3 with QCG middleware",
    "sourcename": "fabsim3qcg.rst.txt",
    "current_page_name": "fabsim3qcg",
    "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">FabSim3 with QCG middleware</a><ul>\n<li><a class=\"reference internal\" href=\"#machine-configuration\">Machine configuration</a></li>\n<li><a class=\"reference internal\" href=\"#job-executing-monitoring-and-fetching-results-on-a-remote-host\">Job Executing, Monitoring, and Fetching results on a remote host</a><ul>\n<li><a class=\"reference internal\" href=\"#job-submisson\">Job Submisson</a></li>\n<li><a class=\"reference internal\" href=\"#job-monitoring\">Job Monitoring</a></li>\n<li><a class=\"reference internal\" href=\"#fetaching-results\">Fetaching results</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
    "page_source_suffix": ".rst"
}