{
    "body": "<p id=\"remotemachineconfig\">This document briefly details how user/developers can set up a remote machine on FabSim3 for job submission.</p>\n<div class=\"section\" id=\"overview\">\n<h1>Overview<a class=\"headerlink\" href=\"#overview\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>The aim of FabSim3 is to automate and simplify the creation, management, execution and modification of complex application workflows, using functionalities such as ensemble runs, remote executions and code couplings. This helps researchers to become more productive in general, and more effective with handling complex applications in particular. For instance, researchers may want to run and rerun static configurations, run a range of slightly different workflows, or to define new types of complex applications altogether.</p>\n<p>FabSim3 is built on top of the <a class=\"reference external\" href=\"http://www.fabfile.org/\">Python Fabric library</a>, and therefore shares automation and remote access features with Fabric (<a class=\"reference external\" href=\"http://www.fabfile.org\">http://www.fabfile.org</a>) and other system-level automation tools such as Ansible (<a class=\"reference external\" href=\"http://www.ansible.com\">http://www.ansible.com</a>) and Homebrew (<a class=\"reference external\" href=\"http://brew.sh\">http://brew.sh</a>).</p>\n</div>\n<div class=\"section\" id=\"fabsim3-remote-job-management-command\">\n<h1>FabSim3 Remote Job Management Command<a class=\"headerlink\" href=\"#fabsim3-remote-job-management-command\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"job-submission\">\n<h2>Job submission<a class=\"headerlink\" href=\"#job-submission\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>To submit a job on the remote machine, type</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fab &lt;remote machine name&gt; &lt;fabsim task&gt;:&lt;input parameters&gt;</span>\n</pre></div>\n</div>\n</div></blockquote>\n<dl class=\"docutils\">\n<dt>This does the following:</dt>\n<dd><ul class=\"first last simple\">\n<li>create required files and folder on your local machine</li>\n<li>transfer all these files and folder to remote machine</li>\n<li>submit a job to the remote machine</li>\n</ul>\n</dd>\n</dl>\n</div>\n<div class=\"section\" id=\"job-monitoring\">\n<h2>Job Monitoring<a class=\"headerlink\" href=\"#job-monitoring\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<ul>\n<li><p class=\"first\"><code class=\"docutils literal notranslate\"><span class=\"pre\">stat</span></code> : returns a report for all submitted jobs or a one in Particular. By default</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fab &lt;remote machine name&gt; job_stat</span>\n</pre></div>\n</div>\n</div></blockquote>\n</li>\n</ul>\n<p>reports the status of jobs. You can also ask for reporting on specific job by</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fab &lt;remote machine name&gt; job_stat:&lt;jobID&gt;</span>\n</pre></div>\n</div>\n</div></blockquote>\n</div>\n<div class=\"section\" id=\"fetching-results\">\n<h2>Fetching results<a class=\"headerlink\" href=\"#fetching-results\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>You can fetch the remote data using</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fab &lt;remote machine name&gt; fetch_results</span>\n</pre></div>\n</div>\n</div></blockquote>\n</div>\n</div>\n<div class=\"section\" id=\"how-to-add-new-remote-a-machine-configuration\">\n<h1>How to add new remote a machine configuration<a class=\"headerlink\" href=\"#how-to-add-new-remote-a-machine-configuration\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>By default, a FabSim3 install will contain 3 machine-specific YML files:</p>\n<blockquote>\n<div><ul class=\"simple\">\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">machines.yml</span></code>, which shows default values for machine-specific variables for each machine.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">machines_user.yml</span></code>, which shows user-specific values for machine-specific variables for each machine. This may include the name of the user account. This file is not committed to the repository.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">machines_user_example.yml</span></code>, a basic example of <code class=\"docutils literal notranslate\"><span class=\"pre\">machines_user.yml</span></code></li>\n</ul>\n</div></blockquote>\n<div class=\"section\" id=\"adding-a-new-machine-to-be-used-by-the-community\">\n<h2>Adding a new machine to be used by the community<a class=\"headerlink\" href=\"#adding-a-new-machine-to-be-used-by-the-community\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>To add a new machine definition, to be used by the community, one can add a corresponding entry to the <code class=\"docutils literal notranslate\"><span class=\"pre\">machines.yml</span></code> file. For example, for the Prometheus supercomputer in Cracow, Poland, this could be done as follow:</p>\n<blockquote>\n<div><div class=\"highlight-yaml notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nt\">prometheus</span><span class=\"p\">:</span>\n  <span class=\"nt\">max_job_name_chars</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">15</span>\n  <span class=\"nt\">job_dispatch</span><span class=\"p\">:</span> <span class=\"s\">&quot;sbatch&quot;</span>\n  <span class=\"nt\">stat</span><span class=\"p\">:</span> <span class=\"s\">&quot;squeue&quot;</span>\n  <span class=\"nt\">run_command</span><span class=\"p\">:</span> <span class=\"s\">&quot;mpiexec</span><span class=\"nv\"> </span><span class=\"s\">-n</span><span class=\"nv\"> </span><span class=\"s\">$cores&quot;</span>\n  <span class=\"nt\">batch_header</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">slurm-prometheus</span>\n  <span class=\"nt\">remote</span><span class=\"p\">:</span> <span class=\"s\">&quot;prometheus.cyfronet.pl&quot;</span>\n  <span class=\"nt\">home_path_template</span><span class=\"p\">:</span> <span class=\"s\">&quot;/net/people/$username&quot;</span>\n  <span class=\"nt\">runtime_path_template</span><span class=\"p\">:</span> <span class=\"s\">&quot;/net/scratch/people/$username&quot;</span>\n  <span class=\"nt\">modules</span><span class=\"p\">:</span> <span class=\"p p-Indicator\">[</span><span class=\"s\">&quot;load</span><span class=\"nv\"> </span><span class=\"s\">apps/lammps&quot;</span><span class=\"p p-Indicator\">]</span>\n  <span class=\"nt\">temp_path_template</span><span class=\"p\">:</span> <span class=\"s\">&quot;$work_path/tmp&quot;</span>\n  <span class=\"nt\">queue</span><span class=\"p\">:</span> <span class=\"s\">&quot;plgrid&quot;</span>\n  <span class=\"nt\">python_build</span><span class=\"p\">:</span> <span class=\"s\">&quot;python2.7&quot;</span>\n  <span class=\"nt\">corespernode</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">24</span>\n</pre></div>\n</div>\n</div></blockquote>\n<p>When defining a new machine in this way, all variables will by default have a value that is specified under the <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;default:&quot;</span></code> heading of <code class=\"docutils literal notranslate\"><span class=\"pre\">machines.yml</span></code>.</p>\n<p>We recommend commiting these typo of definitions to the GitHub repository of FabSim3, unless the machine is non-public.</p>\n</div>\n<div class=\"section\" id=\"adding-user-information-for-an-existing-machine\">\n<h2>Adding user information for an existing machine<a class=\"headerlink\" href=\"#adding-user-information-for-an-existing-machine\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>User information for an existing machine can be added in <code class=\"docutils literal notranslate\"><span class=\"pre\">machines_user.yml</span></code>. Any variable set here will supersede the value in <code class=\"docutils literal notranslate\"><span class=\"pre\">machines.yml</span></code>. For example, for the ARCHER supercomputer, one can enter user information as follows:</p>\n<blockquote>\n<div><div class=\"highlight-yaml notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nt\">archer</span><span class=\"p\">:</span>\n  <span class=\"nt\">username</span><span class=\"p\">:</span> <span class=\"s\">&quot;ucljames&quot;</span>\n  <span class=\"nt\">project</span><span class=\"p\">:</span> <span class=\"s\">&quot;e283&quot;</span>\n  <span class=\"nt\">budget</span><span class=\"p\">:</span> <span class=\"s\">&quot;e283-suter&quot;</span>\n  <span class=\"nt\">lammps_exec</span><span class=\"p\">:</span> <span class=\"s\">&quot;/home/e283/e283/ucljames/lmp_xc30&quot;</span> <span class=\"c1\"># custom variable overwrite</span>\n</pre></div>\n</div>\n</div></blockquote>\n</div>\n<div class=\"section\" id=\"changing-connectivity-settings-for-specific-machines\">\n<h2>Changing connectivity settings for specific machines<a class=\"headerlink\" href=\"#changing-connectivity-settings-for-specific-machines\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Please note that some connectivity settings are not explicitly exposed as FabSim3 environment variables, but are present in the <code class=\"docutils literal notranslate\"><span class=\"pre\">env</span></code> through the original fabric environment variables. An example of such a variable is port, which indicates the port that any SSH connection would rely on.</p>\n<p>A full list of fabric <code class=\"docutils literal notranslate\"><span class=\"pre\">env</span></code> variables can be found on www.fabfile.org, e.g. here: <a class=\"reference external\" href=\"http://docs.fabfile.org/en/1.14/usage/env.html\">http://docs.fabfile.org/en/1.14/usage/env.html</a></p>\n</div>\n<div class=\"section\" id=\"adding-shortened-commands-for-specific-machines\">\n<h2>Adding shortened commands for specific machines<a class=\"headerlink\" href=\"#adding-shortened-commands-for-specific-machines\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>In FabSim3 it is possible to introduce a shortened alias. For instance, you can define a <code class=\"docutils literal notranslate\"><span class=\"pre\">feh</span></code> command to use in place of <code class=\"docutils literal notranslate\"><span class=\"pre\">fab</span> <span class=\"pre\">eagle_vecma</span></code>. Such aliases can help speed up the typing of interactive commands.</p>\n<p>To define an alias, simply type</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fabsim &lt;remote machine name&gt; bash_machine_alias:name=&lt;name_of_alias&gt;</span>\n</pre></div>\n</div>\n</div></blockquote>\n<p>So, given the previous example, one could type</p>\n<blockquote>\n<div><div class=\"highlight-console notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"go\">fabsim eagle_vecma bash_machine_alias:name=feh</span>\n</pre></div>\n</div>\n</div></blockquote>\n<p>Aliases are stored in <code class=\"docutils literal notranslate\"><span class=\"pre\">$FabSim3/bin</span></code> and cannot be named <code class=\"docutils literal notranslate\"><span class=\"pre\">fabsim</span></code>, as that would break the main <code class=\"docutils literal notranslate\"><span class=\"pre\">fabsim</span></code> command.</p>\n<blockquote>\n<div><div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">this has to be done for every user, as different people have different existing shell commands, and we want to avoid accidental conflicts.</p>\n</div>\n</div></blockquote>\n</div>\n</div>\n<div class=\"section\" id=\"qcg-pilot-job-manager\">\n<h1>QCG Pilot Job Manager<a class=\"headerlink\" href=\"#qcg-pilot-job-manager\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>A Pilot Job, is a container for many subjobs that can be started and managed without having to wait individually for resources to become available.</p>\n<p>The <a class=\"reference external\" href=\"https://github.com/vecma-project/QCG-PilotJob\">QCG PilotJob</a> mechanism provides two interfaces that may be used interchangeably. The first one allows to specify a file with the description of sub-jobs and execute the scenario in a batch-like mode, conveniently supporting static scenarios. The second interface is offered with the REST API and it can be accessed remotely in a more dynamic way. It will be used to support scenarios where a number of replicas and their complexity dynamically changes at application runtime.</p>\n<p>Within FabSim3, you can install this python library or any other python library required for you application as a python virtual environment in your account.</p>\n<div class=\"section\" id=\"qcg-pj-installation-on-your-remote-machine\">\n<h2>QCG-PJ installation on your remote machine<a class=\"headerlink\" href=\"#qcg-pj-installation-on-your-remote-machine\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"docutils\">\n<dt>To install QCG-PJ on your remote machine, simply type:</dt>\n<dd><div class=\"first highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fabsim</span> <span class=\"o\">&lt;</span><span class=\"n\">remote</span> <span class=\"n\">machine</span> <span class=\"n\">name</span><span class=\"o\">&gt;</span> <span class=\"n\">install_app</span><span class=\"p\">:</span><span class=\"n\">QCG</span><span class=\"o\">-</span><span class=\"n\">PilotJob</span><span class=\"p\">,</span><span class=\"n\">venv</span><span class=\"o\">=</span><span class=\"kc\">True</span>\n</pre></div>\n</div>\n<div class=\"last admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">All required packages are downloaded and transferred to the remote machine. Therefore, even if the compute nodes do not have an access to Internet, the installation part will be done in off-line mode</p>\n</div>\n</dd>\n</dl>\n</div>\n<div class=\"section\" id=\"python-packages-installation-on-your-remote-machine\">\n<h2>Python packages installation on your remote machine<a class=\"headerlink\" href=\"#python-packages-installation-on-your-remote-machine\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>If you application requires a python package which is not available on pre-installed packages on your remote machine, you can install it as your local virtual environment. To do that, pleas specify the package name in <cite>&lt;FabSim3 directory&gt;deploy/applications.yml`under `packages</cite> entry</p>\n<blockquote>\n<div><div class=\"highlight-yaml notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nt\">packages</span><span class=\"p\">:</span>\n    <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">matplotlib</span>\n</pre></div>\n</div>\n</div></blockquote>\n<dl class=\"docutils\">\n<dt>and then type</dt>\n<dd><div class=\"first last highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">fabsim</span> <span class=\"o\">&lt;</span><span class=\"n\">remote</span> <span class=\"n\">machine</span> <span class=\"n\">name</span><span class=\"o\">&gt;</span> <span class=\"n\">install_packages</span><span class=\"p\">:</span><span class=\"n\">venv</span><span class=\"o\">=</span><span class=\"kc\">True</span>\n</pre></div>\n</div>\n</dd>\n</dl>\n</div>\n</div>\n",
    "title": "Overview",
    "sourcename": "remotemachineconfig.rst.txt",
    "current_page_name": "remotemachineconfig",
    "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Overview</a></li>\n<li><a class=\"reference internal\" href=\"#fabsim3-remote-job-management-command\">FabSim3 Remote Job Management Command</a><ul>\n<li><a class=\"reference internal\" href=\"#job-submission\">Job submission</a></li>\n<li><a class=\"reference internal\" href=\"#job-monitoring\">Job Monitoring</a></li>\n<li><a class=\"reference internal\" href=\"#fetching-results\">Fetching results</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#how-to-add-new-remote-a-machine-configuration\">How to add new remote a machine configuration</a><ul>\n<li><a class=\"reference internal\" href=\"#adding-a-new-machine-to-be-used-by-the-community\">Adding a new machine to be used by the community</a></li>\n<li><a class=\"reference internal\" href=\"#adding-user-information-for-an-existing-machine\">Adding user information for an existing machine</a></li>\n<li><a class=\"reference internal\" href=\"#changing-connectivity-settings-for-specific-machines\">Changing connectivity settings for specific machines</a></li>\n<li><a class=\"reference internal\" href=\"#adding-shortened-commands-for-specific-machines\">Adding shortened commands for specific machines</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#qcg-pilot-job-manager\">QCG Pilot Job Manager</a><ul>\n<li><a class=\"reference internal\" href=\"#qcg-pj-installation-on-your-remote-machine\">QCG-PJ installation on your remote machine</a></li>\n<li><a class=\"reference internal\" href=\"#python-packages-installation-on-your-remote-machine\">Python packages installation on your remote machine</a></li>\n</ul>\n</li>\n</ul>\n",
    "page_source_suffix": ".rst"
}